## 1. JPEG

### 1.1. Общая информация о файле

- Начинается с байт ff d8 ff e0
- MIME: image/jpeg
- Теги начинаются с ff потом байт с идентификатором тега, после 2 длины тега (с учётом этих 2 байт)

### 1.2. Наиболее частые тэги и их структура

#### 1.2.1. APP0(JFIF)

Структура побайтово:
- байты тега: ff e0
- длина тега (2 байта)
- слово jfif\0(5 байт)
- 2 байта, описывающие версию jfif (если 00 01, то 1.01; если 00 02, то 1.02 и т.д.)
- 1 байт, описывающий единицы измерения плотности пикселей
	- 00 - отсутствует информация
	- 01 - пиксели на дюйм
	- 02 - пиксели на сантиметр
- 2 байта  - горизонтальная плотность пикселей
- 2 байта - вертикальная плотность пикселей
- 1 байт - ширина миниатюры (может отсутствовать)
- 1 байт - высота миниатюры (может отсутствовать)

#### 1.2.2. APP1(EXIF)

Структуры побайтово:
- байты тега: ff e1
- длина тега (2 байта)
- слово exif\0\0(6 байт)
Начало tiff-структуры
- тип tiff 2 байта (4d 4d - Big-endian, 49 49 - Little-endian)
- 2 байта (00 2a)
- 4 байта - смещение ifd от начала TIFF (обычно 00 00 00 08, потому что 2 байта тип tiff+2 байта 00 2a + 4 байта длина этого поля)
- 2 байта - количество тегов
- теги tiff:
	Общая структура:
	- 2 байта - id тега
	- 2 байта - формат тега
	- 4 байта - количество компонентов
	- 4 байта - смещение от начала tiff
Наиболее частые теги tiff:
 - Make (производитель камеры)
	 - Tag Id - 01 0f
	 - Формат данных - 00 02 (ASCII)
	 - количество компонентов=длина строки
- Model (модель камеры)
	 - Tag Id - 01 10
	 - Формат данных - 00 02 (ASCII)
	 - количество компонентов=длина строки
- ExposureTime (Время экспозиции)
	 - Tag Id - 82 9a
	 - Формат данных - 00 05 (Rational - дробное число, 8 байт, 4 байта - числитель, 4 байта - знаменатель)
	 - количество компонентов=количество чисел
- FNumber (Апертура)
	 - Tag Id - 82 9d
	 - Формат данных - 00 05 (Rational - дробное число, 8 байт, 4 байта - числитель, 4 байта - знаменатель)
	 - количество компонентов=количество чисел
- ISOSpeedRatings (ISO чувствительность)
	 - Tag Id - 88 27
	 - Формат данных - 00 03 (Short - 2 байта, число вместо смещения)
	 - количество компонентов=длина строки
- UserComment (Пользовательский комментарий)
	 - Tag Id - 92 86
	 - Формат данных - 00 07 (Неинтерпретируемые данные)
	 - количество компонентов=длина строки
	 - особенность: сначала идёт 8 байт с указанием формата строки например:
		 - ASCII\0\0\0
		 - UNICODE\0
- GPSLatitude (Широта)
	 - Tag Id - 00 02
	 - Формат данных - 00 05 (Rational - дробное число, 8 байт, 4 байта - числитель, 4 байта - знаменатель)
	 - количество компонентов=количсетво чисел(обычно 3)
- GPSLongitude (долгота)
	 - Tag Id - 00 04
	 - Формат данных - 00 05 (Rational - дробное число, 8 байт, 4 байта - числитель, 4 байта - знаменатель)
	 - количество компонентов=количсетво чисел(обычно 3)
- GPSLatitudeRef (Широта северная или южная(4e/53))
	- Tag Id - 00 01
	 - Формат данных - 00 02 / 00 03 (ASCII/Short)
- GPSLongitudeRef (Долгота западная или восточная(57/45))
	- Tag Id - 00 03
	 - Формат данных - 00 02 / 00 03 (ASCII/Short)
	
- DateTime (Дата и время)
	 - Tag Id - 01 32
	 - Формат данных - 00 02 (ASCII)
	 - количество компонентов=длина строки
- ImageDescription(Описание изображения)
	- Tag Id - 01 0e
	- Формат данных - 00 02 (ASCII)
	- количество компонентов=длина строки
Форматы данных в TIFF-тегах:
 - 1 - байт
 - 2 - ASCII строка
 - 3 - short(2 байтовое число)
 - 4 - long(4 байтовое число)
 - 5 - rational(4 байта числитель, 4 байта знаменатель)
 - 6 - sbyte(знаковый байт)
 - 7 - undefined(неопределённый массив байт)
 - 8 - SSHORT(знаковое 16 битное число)
 - 9 - SLONG(знаковое 32 битное число)
 - 10 - SRATIONAL(4 байта числитель знаковый, 4 байта знаменатель знаковый)
 - 11 - FLOAT(32 битное число с плавающей точкой)
 - 12 - DOUBLE(64 битное число с плавающей точкой)

#### 1.2.3. Комментарий
Структура:
- ff fe - байт идентификатор
- 2 байта длина
- текст
#### 1.2.4. Тип маркера
Структура:
 - ff c0/c1/c2/c3 - SOF0,1,2,3 (0 - Baseline DCT; 1 - Extended Sequential DCT; 2 - Progressive DCT; 3 - Lossless)
 - 2 байта - длина
 - 1 байт - точность в битах на компонент
 - 2 байта - ширина изображения
 - 2 байта - высота изображения

### 1.3. Изменяемые поля (без поломки изображения)

- APP1 - все данные
- APP0
	- Версия JFIF
	- Разрешение изображения (если оно не используется при отображении)
- COM - любые данные
## 2. PNG
### 2.1. Общая информация о файле
- Начинается с байт 89 50 4e 47
- MIME: image/png
- Стандартная структура блока
	- 4 байта - длина блока
	- 4 байта - тип блока
	- данные в блоке
	- 4 байта - crc32 сумма от всех байт в блока (кроме длины)
### 2.2. Стандартные теги
#### 2.2.1. IHDR
 - 4 байта - длина
 - 4 байта - IHDR (49 48 44 52)
 - 4 байта - ширина
 - 4 байта - высота
 - 1 байт - битовая глубина на канал
 - 1 байт - тип цветовой модели
	 - 00 - оттенки серого
	 - 02 - RGB
	 - 03 - индексированная палитра
	 - 04 - оттенки серого + альфа
	 - 06 - RGBA
- 1 байт - метод сжатия
- 1 байт - метод фильтрации
- 1 байт - метод развёртки
	- 00 - нет развёртки
	- 01 - Adam7
- 4 байта - crc32
#### 2.2.2. IDAT
- 4 байта - длина
- 4 байта - IDAT (49 44 41 54)
- сжатые данные изображения
- 4 байта - crc32
#### 2.2.3. pHYs
- 4 байта - длина
- 4 байта - pHYs (70 48 59 73)
- 4 байта - количество пикселей на единицу длины по горизонтали
- 4 байта - количество пикселей на единицу длины по вертикали
- 1 байт - единица измерения
	- 00 - безразмерная единица (зачастую обозначает соотношение сторон)
	- 01 - метры
- 4 байта - crc32
#### 2.2.4. IEND
- 4 байта - длина (00 00 00 00)
- 4 байта - IEND (49 45 4E 44)
- 4 байта - crc32
#### 2.2.5. tEXt
 - 4 байта - длина
 - 4 байта - tEXt (74 45 58  74)
 - заголовок комментария (до байта 00)
 - текст комментария (до конца блока)
### 2.3. Изменяемые поля (без поломки изображения)

- IHDR
	- ширина
	- высота
- pHYs
	- количество пикселей на единицу длины по горизонтали
	- количество пикселей на единицу длины по вертикали
	- единица измерения
- tEXt
	- заголовок и данные
## 3. TIFF
### 3.1. Общая информация о файле

- Начинается с байт 49 49 2A 00 (Little-Endian), 4D 4D 00 2A (Big-endian)
- MIME: image/tiff
- Смещение до первого IFD
### 3.2 Стандартные теги (id указывается в big-endian)

| Идентификатор тега | Название тега             | Описание                                                                         | Наиболее распространённый тип данных |
| ------------------ | ------------------------- | -------------------------------------------------------------------------------- | ------------------------------------ |
| 0x01 0x00          | ImageWidth                | Ширина изображения в пикселях.                                                   | 0x00 0x04                            |
| 0x01 0x01          | ImageLength               | Высота изображения в пикселях.                                                   | 0x00 0x04                            |
| 0x01 0x02          | BitsPerSample             | Битовая глубина для каждого канала.                                              | 0x00 0x03                            |
| 0x01 0x03          | Compression               | Метод сжатия.                                                                    | 0x00 0x03                            |
| 0x01 0x06          | PhotometricInterpretation | Цветовое пространство.                                                           | 0x00 0x03                            |
| 0x01 0x11          | StripOffsets              | Смещения до блоков данных изображения.                                           | 0x00 0x04                            |
| 0x01 0x15          | SamplesPerPixel           | Количество цветовых каналов.                                                     | 0x00 0x03                            |
| 0x01 0x16          | RowsPerStrip              | Количество строк в одной полосе.                                                 | 0x00 0x03                            |
| 0x01 0x17          | StripByteCounts           | Размер каждого блока данных в байтах.                                            | 0x00 0x04                            |
| 0x01 0x1A          | XResolution               | Горизонтальное разрешение.                                                       | 0x00 0x05                            |
| 0x01 0x1B          | YResolution               | Вертикальное разрешение.                                                         | 0x00 0x05                            |
| 0x01 0x28          | ResolutionUnit            | Единица измерения разрешения.                                                    | 0x00 0x03                            |
| 0x01 0x0F          | Make                      | Производитель камеры.                                                            | 0x00 0x02                            |
| 0x01 0x10          | Model                     | Модель камеры.                                                                   | 0x00 0x02                            |
| 0x82 0x9A          | ExposureTime              | Время экспозиции.                                                                | 0x00 0x05                            |
| 0x82 0x9D          | FNumber                   | Апертура.                                                                        | 0x00 0x05                            |
| 0x88 0x27          | ISOSpeedRating            | ISO-чувствительность.                                                            | 0x00 0x03                            |
| 0x92 0x86          | UserComment               | Пользовательский комментарий.                                                    | 0x00 0x07                            |
| 0x00 0x01          | GPSLatitudeRef            | Направление широты (символ «N» , если северная широта, и «S», если южная).       | 0x00 0x02                            |
| 0x00 0x02          | GPSLatitude               | Широта (3 рациональных числа — градусы, минуты, секунды).                        | 0x00 0x05                            |
| 0x00 0x03          | GPSLogitudeRef            | Направление долготы (символ «E» , если восточная долгота, и «W», если западная). | 0x00 0x02                            |
| 0x00 0x04          | GPSLogitude               | Долгота (3 рациональных числа — градусы, минуты, секунды).                       | 0x00 0x05                            |
| 0x01 0x32          | DateTime                  | Дата и время создания файла.                                                     | 0x00 0x02                            |
| 0x01 0x0E          | ImageDescription          | Описание изображения.                                                            | 0x00 0x02                            |

## 4. GIF
### 4.1. Общая информация о файле
- Начинается с байт  0x47 0x49 0x46 потом 3 байта - версия gif Далее идут следующие поля:
	- Логический экран:
		- 2 байта — ширина экрана;
		- 2 байта — высота экрана;
		- 1 байт — флаги:
			- 1 бит — размер глобальной цветовой палитры;
			- 1 бит — сортировка цветов;
			- 2 бита — биты резерва;
			- 3 бита — количество бит на цвет;
		- 1 байт — индекс цвета из глобальной таблицы;
		- 1 байт — соотношение сторон (обычно 0x00).
	- Блоки изображений.
	- Расширения.
		Все расширения в GIF начинаются с байта 0x21, после этого идёт идентификатор расширения.
- MIME: image/gif
- Стандартная структура блока
	- id блока (2 байта)
	- длина блока (1 байт)
	- данные блока
### 4.2. Стандартные расширения
- GCE (Graphic Control Extension)
	Используется для управления анимацией и прозрачностью.
	Структура:
	- Идентификатор: 0xF9;
	- 1 байт — длина блока;
	- 1 байт — флаги:
		- 1 бит — размер прозрачного цвета;
		- 2 бита — тип удаления предыдущего кадра;
	 - 2 байта — задержка в сотых секунды;
	 - 1 байт — индекс прозрачного цвета.
- Comment Extension
	Содержит текстовые комментарии.
	Структура:
	- Идентификатор: 0xFE;
	- 1 байт — длина блока;
	- данные блока заканчивающиеся нулевым байтом.
- Application Extension
	Хранит пользовательские данные.
	Структура:
	- Идентификатор: 0xFF;
	- 1 байт — длина блока;
	- идентификатор приложения;
	- данные приложения.
- Plain Text Extension
	 
	Структура:
	- Идентификатор: 0x01;
	- 1 байт - длина блока;
	- 2 байта - отступ от левого края;
	- 2 байта - отступ от верхнего края;
	- 2 байта - ширина области;
	- 2 байта - высота области;
	- 1 байт - высота символа;
	- 1 байт - ширина символа;
	- 1 байт - цвет текста;
	- 1 байт - цвет фона;
	- 1 байт - длина;
	- данные.
### 4.3. Изменяемые расширения
- Comment Extension
- Plain Text Extension
- GCE (Graphic Control Extension)
