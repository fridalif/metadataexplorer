## 1. JPEG

### 1.1. Общая информация о файле

- Начинается с байт ff d8 ff e0
- MIME: image/jpeg
- Теги начинаются с ff потом байт с идентификатором тега, после 2 длины тега (с учётом этих 2 байт)

### 1.2. Наиболее частые тэги и их структура

#### 1.2.1. APP0(JFIF)

Структура побайтово:
- байты тега: ff e0
- длина тега (2 байта)
- слово jfif\0(5 байт)
- 2 байта, описывающие версию jfif (если 00 01, то 1.01; если 00 02, то 1.02 и т.д.)
- 1 байт, описывающий единицы измерения плотности пикселей
	- 00 - отсутствует информация
	- 01 - пиксели на дюйм
	- 02 - пиксели на сантиметр
- 2 байта  - горизонтальная плотность пикселей
- 2 байта - вертикальная плотность пикселей
- 1 байт - ширина миниатюры (может отсутствовать)
- 1 байт - высота миниатюры (может отсутствовать)

#### 1.2.2. APP1(EXIF)

Структуры побайтово:
- байты тега: ff e1
- длина тега (2 байта)
- слово exif\0\0(6 байт)
Начало tiff-структуры
- тип tiff 2 байта (4d 4d - Big-endian, 49 49 - Little-endian)
- теги tiff:
	Общая структура:
	- 2 байта - id тега
	- 2 байта - формат тега
	- 4 байта - количество компонентов
	- 4 байта - смещение от начала tiff
Наиболее частые теги tiff:
 - Make (производитель камеры)
	 - Tag Id - 01 0f
	 - Формат данных - 00 02 (ASCII)
	 - количество компонентов=длина строки
- Model (модель камеры)
	 - Tag Id - 01 10
	 - Формат данных - 00 02 (ASCII)
	 - количество компонентов=длина строки
- ExposureTime (Время экспозиции)
	 - Tag Id - 82 9a
	 - Формат данных - 00 05 (Rational - дробное число, 8 байт, 4 байта - числитель, 4 байта - знаменатель)
	 - количество компонентов=количество чисел
- FNumber (Апертура)
	 - Tag Id - 82 9d
	 - Формат данных - 00 05 (Rational - дробное число, 8 байт, 4 байта - числитель, 4 байта - знаменатель)
	 - количество компонентов=количество чисел
- ISOSpeedRatings (ISO чувствительность)
	 - Tag Id - 88 27
	 - Формат данных - 00 03 (Short - 2 байта, число вместо смещения)
	 - количество компонентов=длина строки
- UserComment (Пользовательский комментарий)
	 - Tag Id - 92 86
	 - Формат данных - 00 07 (Неинтерпретируемые данные)
	 - количество компонентов=длина строки
	 - особенность: сначала идёт 8 байт с указанием формата строки например:
		 - ASCII\0\0\0
		 - UNICODE\0
- GPSLatitude (Широта)
	 - Tag Id - 00 02
	 - Формат данных - 00 05 (Rational - дробное число, 8 байт, 4 байта - числитель, 4 байта - знаменатель)
	 - количество компонентов=количсетво чисел(обычно 3)
- GPSLongitude (долгота)
	 - Tag Id - 00 04
	 - Формат данных - 00 05 (Rational - дробное число, 8 байт, 4 байта - числитель, 4 байта - знаменатель)
	 - количество компонентов=количсетво чисел(обычно 3)
- GPSLatitudeRef (Широта северная или южная(4e/53))
	- Tag Id - 00 01
	 - Формат данных - 00 02 / 00 03 (ASCII/Short)
- GPSLongitudeRef (Долгота западная или восточная(57/45))
	- Tag Id - 00 01
	 - Формат данных - 00 02 / 00 03 (ASCII/Short)
	
- DateTime (Дата и время)
	 - Tag Id - 01 32
	 - Формат данных - 00 02 (ASCII)
	 - количество компонентов=длина строки
- ImageDescription(Описание изображения)
	- Tag Id - 01 0e
	- Формат данных - 00 02 (ASCII)
	- количество компонентов=длина строки
Форматы данных в TIFF-тегах:
 - 1 - байт
 - 2 - ASCII строка
 - 3 - short(2 байтовое число)
 - 4 - long(4 байтовое число)
 - 5 - rational(4 байта числитель, 4 байта знаменатель)
 - 6 - sbyte(знаковый байт)
 - 7 - undefined(неопределённый массив байт)
 - 8 - SSHORT(знаковое 16 битное число)
 - 9 - SLONG(знаковое 32 битное число)
 - 10 - SRATIONAL(4 байта числитель знаковый, 4 байта знаменатель знаковый)
 - 11 - FLOAT(32 битное число с плавающей точкой)
 - 12 - DOUBLE(64 битное число с плавающей точкой)

#### 1.2.3. Комментарий
Структура:
- ff fe - байт идентификатор
- 2 байта длина
- текст
#### 1.2.4. Тип маркера
Структура:
 - ff c0/c1/c2/c3 - SOF0,1,2,3 (0 - Baseline DCT; 1 - Extended Sequential DCT; 2 - Progressive DCT; 3 - Lossless)
 - 2 байта - длина
 - 1 байт - точность в битах на компонент
 - 2 байта - ширина изображения
 - 2 байта - высота изображения

### 1.3. Изменяемые поля (без поломки изображения)

- APP1 - все данные
- APP0
	- Версия JFIF
	- Разрешение изображения (если оно не используется при отображении)
- COM - любые данные
## 2. PNG
### 2.1. Общая информация о файле
- Начинается с байт 89 50 4e 47
- MIME: image/png
- Стандартная структура блока
	- 4 байта - длина блока
	- 4 байта - тип блока
	- данные в блоке
	- 4 байта - crc32 сумма от всех байт в блока (кроме длины)
### 2.2. Стандартные теги
#### 2.2.1. IHDR
 - 4 байта - длина
 - 4 байта - IHDR (49 48 44 52)
 - 4 байта - ширина
 - 4 байта - высота
 - 1 байт - битовая глубина на канал
 - 1 байт - тип цветовой модели
	 - 00 - оттенки серого
	 - 02 - RGB
	 - 03 - индексированная палитра
	 - 04 - оттенки серого + альфа
	 - 06 - RGBA
- 1 байт - метод сжатия
- 1 байт - метод фильтрации
- 1 байт - метод развёртки
	- 00 - нет развёртки
	- 01 - Adam7
- 4 байта - crc32
#### 2.2.2. IDAT
- 4 байта - длина
- 4 байта - IDAT (49 44 41 54)
- сжатые данные изображения
- 4 байта - crc32
#### 2.2.3. pHYs
- 4 байта - длина
- 4 байта - pHYs (70 48 59 73)
- 4 байта - количество пикселей на единицу длины по горизонтали
- 4 байта - количество пикселей на единицу длины по вертикали
- 1 байт - единица измерения
	- 00 - безразмерная единица (зачастую обозначает соотношение сторон)
	- 01 - метры
- 4 байта - crc32
#### 2.2.4. IEND
- 4 байта - длина (00 00 00 00)
- 4 байта - IEND (49 45 4E 44)
- 4 байта - crc32
#### 2.2.5. tEXt
 - 4 байта - длина
 - 4 байта - tEXt (74 45 58  74)
 - заголовок комментария (до байта 00)
 - текст комментария (до конца блока)
### 2.3. Изменяемые поля (без поломки изображения)

- IHDR
	- ширина
	- высота
- pHYs
	- количество пикселей на единицу длины по горизонтали
	- количество пикселей на единицу длины по вертикали
	- единица измерения
- tEXt
	- заголовок и данные